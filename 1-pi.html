<!DOCTYPE html>
        <html>
        <head>
            <meta charset="UTF-8">
            <title>Ubuntu-22&period;04-server-arm64&period;img&#xb97c; &#xc124;&#xce58;&#xd558;&#xc790;</title>
            <style>
/* From extension vscode.github */
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

.vscode-dark img[src$=\#gh-light-mode-only],
.vscode-light img[src$=\#gh-dark-mode-only],
.vscode-high-contrast:not(.vscode-high-contrast-light) img[src$=\#gh-light-mode-only],
.vscode-high-contrast-light img[src$=\#gh-dark-mode-only] {
	display: none;
}

</style>
            <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex/dist/katex.min.css">
<link href="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.css" rel="stylesheet" type="text/css">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/markdown.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/highlight.css">
<style>
            body {
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe WPC', 'Segoe UI', system-ui, 'Ubuntu', 'Droid Sans', sans-serif;
                font-size: 14px;
                line-height: 1.6;
            }
        </style>
        <style>
.task-list-item {
    list-style-type: none;
}

.task-list-item-checkbox {
    margin-left: -20px;
    vertical-align: middle;
    pointer-events: none;
}
</style>
<style>
:root {
  --color-note: #0969da;
  --color-tip: #1a7f37;
  --color-warning: #9a6700;
  --color-severe: #bc4c00;
  --color-caution: #d1242f;
  --color-important: #8250df;
}

</style>
<style>
@media (prefers-color-scheme: dark) {
  :root {
    --color-note: #2f81f7;
    --color-tip: #3fb950;
    --color-warning: #d29922;
    --color-severe: #db6d28;
    --color-caution: #f85149;
    --color-important: #a371f7;
  }
}

</style>
<style>
.markdown-alert {
  padding: 0.5rem 1rem;
  margin-bottom: 16px;
  color: inherit;
  border-left: .25em solid #888;
}

.markdown-alert>:first-child {
  margin-top: 0
}

.markdown-alert>:last-child {
  margin-bottom: 0
}

.markdown-alert .markdown-alert-title {
  display: flex;
  font-weight: 500;
  align-items: center;
  line-height: 1
}

.markdown-alert .markdown-alert-title .octicon {
  margin-right: 0.5rem;
  display: inline-block;
  overflow: visible !important;
  vertical-align: text-bottom;
  fill: currentColor;
}

.markdown-alert.markdown-alert-note {
  border-left-color: var(--color-note);
}

.markdown-alert.markdown-alert-note .markdown-alert-title {
  color: var(--color-note);
}

.markdown-alert.markdown-alert-important {
  border-left-color: var(--color-important);
}

.markdown-alert.markdown-alert-important .markdown-alert-title {
  color: var(--color-important);
}

.markdown-alert.markdown-alert-warning {
  border-left-color: var(--color-warning);
}

.markdown-alert.markdown-alert-warning .markdown-alert-title {
  color: var(--color-warning);
}

.markdown-alert.markdown-alert-tip {
  border-left-color: var(--color-tip);
}

.markdown-alert.markdown-alert-tip .markdown-alert-title {
  color: var(--color-tip);
}

.markdown-alert.markdown-alert-caution {
  border-left-color: var(--color-caution);
}

.markdown-alert.markdown-alert-caution .markdown-alert-title {
  color: var(--color-caution);
}

</style>
        
        </head>
        <body class="vscode-body vscode-light">
            <h2 id="ubuntu-2204-server-arm64img를-설치하자">Ubuntu-22.04-server-arm64.img를 설치하자</h2>
<h3 id="목표-미니-컴퓨터-이해">목표: 미니 컴퓨터 이해</h3>
<p>작성자: kkongnyang2 작성일: 2025-06-09</p>
<hr>
<h3 id="0-환경-점검">0&gt; 환경 점검</h3>
<p>하드웨어: raspberrypi4 model B<br>
├─cpu: arm cortex A72<br>
├─ram: 4GB<br>
└─sd카드: 32GB micro<br>
운영체제: 설치 예정<br>
외부 저장장치: 없음</p>
<blockquote>
<p>⚠️ 원래는 usb로 부팅하려 했으나 실패. 그냥 공식대로 sd카드로 하는게 안전해보임<br>
⚠️ 모니터 연결을 위해선 microHDMI가 필요하지만 ssh로 대체 가능.</p>
</blockquote>
<hr>
<h3 id="1-sd-카드-만들기---방법1-etcher로-굽기권장x">1&gt; sd 카드 만들기 - 방법1. etcher로 굽기(권장x)</h3>
<p>step 1. ubuntu-22.04.5-preinstalled-server-arm64+raspi.img.xz 다운받기</p>
<ul>
<li>preintalled: 얘는 따로 설치 없이 이미 그 자체를 저장장치로 씀.</li>
</ul>
<p>step 2. balena-etcher 2.1.2 다운로드</p>
<pre><code class="language-bash">인터넷에서 balena-etcher.deb 파일 다운
~$ sudo dpkg -i ~/Downloads/balena-etcher_2.1.2_amd64.deb
</code></pre>
<p>step 3. balenaEtcher로 해당 이미지를 sd 카드에 굽기</p>
<p>step 4. 부팅시 ssh를 위해 system-boot에서 cloud-init 미리 설정해주기</p>
<pre><code class="language-bash">~$ <span class="hljs-built_in">touch</span> /media/<span class="hljs-variable">$USER</span>/system-boot/ssh       <span class="hljs-comment">#ssh 빈파일 만들기</span>
~$ nano /media/<span class="hljs-variable">$USER</span>/system-boot/network-config <span class="hljs-comment">#네트워크 설정</span>
wifis:
  wlan0:
    dhcp4: <span class="hljs-literal">true</span>
    optional: <span class="hljs-literal">true</span>
    access-points:
      <span class="hljs-string">&quot;KT_GiGA_1D39&quot;</span>:
        password: <span class="hljs-string">&quot;eec0hc4206&quot;</span>

    regulatory-domain: KR
~$ nano /media/<span class="hljs-variable">$USER</span>/system-boot/cloud-config   <span class="hljs-comment">#사용자 설정</span>
hostname: raspberrypi
ssh_pwauth: <span class="hljs-literal">true</span>
disable_root: <span class="hljs-literal">false</span>
chpasswd:
  list: |
    ubuntu:ubuntu
  expire: <span class="hljs-literal">false</span>
</code></pre>
<ul>
<li><code>hostname</code>: 네트워크에서 표시될 이름</li>
<li><code>ssh_pwauth</code>: true: SSH 비밀번호 로그인 허용</li>
<li><code>chpasswd</code>: 초기 사용자 계정(ubuntu) 비밀번호 설정</li>
</ul>
<blockquote>
<p>⚠️ 만약 라즈비언os라면 wpa_supplicant.conf를 만들어주기</p>
</blockquote>
<hr>
<h3 id="2-sd-카드-만들기---방법2-raspi-imager로-굽기">2&gt; sd 카드 만들기 - 방법2. raspi-imager로 굽기</h3>
<p>step 1. ubuntu-22.04.5-preinstalled-server-arm64+raspi.img.xz 다운받기</p>
<ul>
<li>preintalled: 얘는 따로 설치 없이 이미 그 자체를 저장장치로 씀.</li>
</ul>
<p>step 2. rpi-imgaer 1.9.3 다운로드</p>
<pre><code class="language-bash">~$ sudo snap install rpi-imager
</code></pre>
<p>step 3. rpi-imager에서 굽기 전 사용자 커스터마이징</p>
<pre><code>hostname: raspberrypi.local
사용자 이름: kkongnyang2
비밀번호: U2FsdGVkX19dkJUxkq0yzdg74lVWKoQtbJma/YUyJCs=(업로드용)
무선 LAN SSID: KT_GiGA_1D39
무선 LAN 비밀번호: eec0hc4206
무선 LAN 국가: KR
로케일 설정 지정: Asia/Seoul
키보드 레이아웃: us
ssh 사용: 비밀번호로
</code></pre>
<hr>
<h3 id="3-부팅하기">3&gt; 부팅하기</h3>
<p>step 1. 라즈베리파이에 sd를 꽂고 act led가 적어질 때까지 기다리기</p>
<p>step 2. 공유기 들어가서 새로 연결된 단말의 ip 확인</p>
<pre><code>http://172.30.1.254로 들어갔더니 라즈베리파이 172.30.1.89 확인
</code></pre>
<p>step 3. 노트북에서 라즈베리파이 ssh 접속</p>
<pre><code class="language-bash">~$ ssh kkongnyang2@172.30.1.89
The authenticity of host <span class="hljs-string">&#x27;172.30.1.89 (172.30.1.89)&#x27;</span> can<span class="hljs-string">&#x27;t be established.
ED25519 key fingerprint is SHA256:B5ycXkgh3UjpXdAqAmERIIt83MZghSEiIo+p+tj3fvo.    #처음에 ssh키 생성
This key is not known by any other names
Are you sure you want to continue connecting (yes/no/[fingerprint])?  yes
Warning: Permanently added &#x27;</span>172.30.1.89<span class="hljs-string">&#x27; (ED25519) to the list of known hosts.
kkongnyang2@172.30.1.89&#x27;</span>s password: 
Welcome to Ubuntu 22.04.5 LTS (GNU/Linux 5.15.0-1061-raspi aarch64)
~$ <span class="hljs-built_in">exit</span>                       <span class="hljs-comment">#ssh 종료 명령어</span>
</code></pre>
<blockquote>
<p>⚠️ 기존 known_hosts를 지워야 한다면</p>
</blockquote>
<pre><code>~$ ssh-keygen -R 172.30.1.89
</code></pre>
<p>step 4. 패키지 최신상태 확인</p>
<pre><code class="language-bash">~$ sudo apt update &amp;&amp; sudo apt upgrade -y
커널 새버전 업데이트 됐는데 알아서 재부팅하라는 안내문 -&gt; 확인
서비스들 지금 재시작할거니? -&gt; tab으로 cancel 선택(어차피 재부팅할거니)
</code></pre>
<ul>
<li>&amp;&amp;는 명령어 연속. -y는 자동 yes</li>
</ul>
<p>step 5. 재부팅</p>
<pre><code class="language-bash">~$ sudo poweroff          <span class="hljs-comment">#전원끄기</span>
act led 반응 없고 빨간불만 남으면 전원 뽑기.
그리고 전원 꼽으면 다시 부팅
</code></pre>
<p>step 6. eeprom 최신상태 확인</p>
<pre><code class="language-bash">~$ sudo rpi-eeprom-update
BOOTLOADER: up to <span class="hljs-built_in">date</span>
   CURRENT: Tue Jan 25 14:30:41 UTC 2022 (1643121041)
    LATEST: Tue Jan 25 14:30:41 UTC 2022 (1643121041)
   RELEASE: default (/lib/firmware/raspberrypi/bootloader/default)
            Use raspi-config to change the release.

  VL805_FW: Dedicated VL805 EEPROM
     VL805: up to <span class="hljs-built_in">date</span>
   CURRENT: 000138a1
    LATEST: 000138a1
</code></pre>
<ul>
<li>이미 최신 버전이니 건드릴 필요x</li>
</ul>
<hr>
<h3 id="4-부팅-설정파일-만들어지는-과정">4&gt; 부팅 설정파일 만들어지는 과정</h3>
<p>step 0. SD 카드 제작:	pi OS 이미지를 굽는 시점에 /boot/firmware/network-config, user-data, meta-data 등의 시드(seed) 파일을 넣어 둔다.<br>
step 1. init-local: cloud-init-local.service가 파티션 확장, seed 파일 수집.<br>
step 2. init: cloud-init.service가 시드 설정으로 /etc/netplan/50-cloud-init.yaml•/etc/hostname 등을 작성.<br>
step 3. modules: cloud-config.service, cloud-final.service가 유저 추가, SSH 키 배포, 팩키지 설치 “run-once” 모듈 실행.<br>
step 4. 정상 부팅: 이제부터는 일반 부팅 루틴. systemd-networkd, sshd 등이 작동.</p>
<p>/var/lib/cloud/instance/<br>
├─ cloud-config.txt<br>
├─ datasource.json<br>
└─ boot-finished -&gt; 이게 있으면 첫 부팅 아닌걸로 인지.</p>

            <script async src="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.js"></script>
            
        </body>
        </html>