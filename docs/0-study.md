### 1> 서버란?

"내 컴퓨터가 다른 기기의 요청을 받아 응답할 수 있게 만든다"
`http://컴퓨터주소`를 입력하면 내 컴퓨터가 웹사이트, 파일, 사진을 보내주는 역할.

그럼 컴퓨터 주소가 뭔지를 설명해야한다.

네트워크는 크게 로컬 네트워크와 외부 네트워크로 나뉜다.
로컬 네트워크는 한 공유기 내에 기기들이 wi-fi(무선 랜선)로 서로 연결되어 로컬 ip주소로 서로를 찾는 것이다.
이때 공유기는 라우터 기능을 겸용하여 외부에 집 안내원 역할도 해준다. 외부 공인 ip주소(집주소)를 바깥에 내세우는 것이다.
쉽게 말해 외부 공인 ip주소 = 집주소, 로컬 ip주소 = 안방, mac 주소 = 김철수

내 컴퓨터로 만든 서버 주소 = 내 컴퓨터 로컬 ip주소지만, 외부에서는 우리들 방까지 알 수는 없다.
따라서 외부에서 `http://공유기 외부 공인 ip` 를 치고 들어오면 내 로컬 주소로 들어올 수 있도록 누가 안내해줘야 한다. 그게 포트포워딩이다. 

접속 과정
1. 누군가 공유기 주소를 입력
2. 라우터(공유기)가 포트포워딩으로 해당 요청을 내 컴퓨터로 전달
3. 내 컴퓨터가 응답하여 파일 등을 반환 


### 2> 프로토콜

“TCP 소켓(IP:Port) 위에서 SSH/HTTP/HTTPS 같은 응용 프로토콜이 자기 규칙대로 대화한다.”

[응용 계층]  SSH   HTTP   HTTPS   …
──────────────────────────────────
[전송 계층]  TCP (or UDP)
──────────────────────────────────
[인터넷 계층]  IP
──────────────────────────────────
[링크 계층]   이더넷, Wi-Fi …

응용 계층 프로토콜
ssh(22) : 원격 터미널, 파일 전송을 암호화해서 제공
http(80) : 웹 페이지 요청 및 응답
https(443) : http에 tls 암호화
같은 tcp 위에서 여러 응용 프로토콜이 포트를 나눠씀

전송 계층 프로토콜
tcp : 데이터가 순서, 무결성을 잃지 않도록 전달
끝점을 (IP, Port) ↔ (IP, Port) 쌍으로 구분

ip 주소 : 어느 컴퓨터냐
포트 번호 : 그 컴퓨터 안의 어느 서비스냐(창구번호)

[클라이언트]           [서버]
     49152              22       ← SSH용 소켓
     50432              80       ← HTTP용 소켓
     49500              443      ← HTTPS용 소켓
   (임의)

8080같은 임의 포트로 웹서버를 띄우려면 http://example.com:8080



### 3> ssh?
네트워크를 통한 다른 컴퓨터 원격 접속 프로토콜.
주로 원격 로그인(라즈베리파이 터미널 연결), 파일 전송(git), 포트 포워딩용.

sshd : 서버 측 데몬으로, ssh 연결을 대기함

step 1. 서버 신뢰성
```
1. 서버는 /etc/ssh/ssh_host_ed25519_key와 그.pub에 ssh-ed25519, ssh-rsa, ecdsa-sha2-nistp256 세 개의 host key의 공개키-개인키를 준비해 둠.
2. 클라이언트가 접속하면, 서버는 자신의 host key의 공개키를 제시하고 개인키로 서명하여 본인 인증도 함께 보냄
3. 클라이언트는 ~/.ssh/known_hosts를 참고하여 예전과 동일한 키인지 확인함
4. 없으면 새로 추가하고, 동일하면 "이 서버는 내가 알던 서버다" = MITM(중간자 공격) 방지
```

step 2. 로그인 (비밀번호 로그인으로 대체 가능)
```
1. 클라이언트는 ssh-keygen -t ed25519로 개인키(열쇠), 공개키(자물쇠)를 쌍으로 생성
2. 공개키는 ~/.ssh/id_ed25519.pub에 ssh-ed25519 | base64로 인코딩된 키 100자 정도 | 주석 형식으로 저장.
3. 개인키는 ~/.ssh/id_ed25519에 -----BEGIN OPENSSH PRIVATE KEY-----base64로 인코딩된 키 400~800자-----END OPENSSH PRIVATE KEY----- 형식으로 저장.
4. 공개키를 서버에 직접 적어놔 이를 로그인용 authorized_key로 만듦. 이때 보통 SHA256(공개키를 요약한 fingerprint)로 간단히 표기됨.
5. 서버에 로그인할때마다 공개키를 제시하고 개인키로 서명하여 본인 인증도 함께 보냄.
6. 서버는 공개키 목록을 보고 있는지 확인함.
```


### 4> 퍼미션

755
소유자/그룹/기타 순
읽기=4 쓰기=2 실행=1 rwx

| 경로                                          | 소유자:그룹              | 디렉터리    | 파일      | 설명                                  |
| ------------------------------------------- | ------------------- | ------- | ------- | ----------------------------------- |
| **`/var/www/html`** *(웹루트 상위)*              | `root:root`         | **755** | n/a     | 코드·데이터를 직접 포함하지 않으므로 **읽기 전용**으로 잠금 |
| **`/var/www/html/nextcloud`** *(애플리케이션 코드)* | `www-data:www-data` | **750** | **640** | 앱이 캐시·업데이트 파일을 쓸 수 있도록 소유자 변경       |
| **`/srv/nextcloud-data`** *(USB 데이터 폴더)*    | `www-data:www-data` | **750** | **640** | 업 / 다운로드·섬네일 저장 등 **쓰기** 필요         |


### 5> 암호화

암호 알고리즘 AES, RSA
실제 계산을 담당하는 수학적 방법

- 대칭키 암호화 (암호화 복호화에 키 사용) AES
- 공개키 암호화 (공개키/개인키 쌍) RSA
- 해시 알고리즘 (사실 암호화는 아님) SHA256

도구/라이브러리 openssl, gpg, age, bcrypt
암호 알고리즘을 실행하는 프로그램

포맷/규약/표준 PGP, PEM
암호화 데이터를 저장하고 교환하는 방식을 정의한 문서 형식


